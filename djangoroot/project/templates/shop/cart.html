{% extends "base.html" %}
{% load i18n %}
{% block content %}
<h1>{% trans "Your shopping cart" %}</h1>
{% if request.GET.err or cart.total_price > user.coins.count %}
<p class="text-error">
    {% if request.GET.err == "insufficient_balance" or cart.total_price > user.coins.count %}
    You do not have enough Horowitz Coins to complete this purchase. <a href="#">Buy some Horowitz Coins?</a>
    {% endif %}
</p>
{% endif %}
{% if cart_items %}
<form method="post" action="{% url 'cart_update' %}">
    {% csrf_token %}
    {{ formset.management_form }}
    <table border="1" class="cart">
        <thead>
            <tr>
                <th>{% trans "Product name" %}</th>
                <th colspan="2"></th>
                <th class="price_hdr">{% trans "Unit price" %}</th>
            </tr>
        </thead>

        <tbody>
        {% for form in formset %}
        {% with form.quantity as field %}
            <tr>
                <td>{{ form.instance.product.get_name }}</td>
                <td colspan="2"></td>
                <td>{{ form.instance.product.get_price }}</td>
            </tr>
            {% for extra_price_field in form.instance.extra_price_fields %}
            <tr>
                <td colspan="2">&nbsp;</td>
                <td>{{ extra_price_field.0 }}</td>
                <td>{{ extra_price_field.1 }}</td>
            </tr>
            {% endfor %}
            <!--<tr><td colspan="2">&nbsp;</td><td>{% trans "Line Total" %}:</td><td>{{ form.instance.line_total }}</td></tr>-->
        {% endwith %}
        {% endfor %}
        </tbody>

        <tfoot>
            <!--<tr><td colspan="2">&nbsp;</td><td>{% trans "Cart Subtotal" %}</td><td>{{cart.subtotal_price}}</td></tr>-->
            {% for extra_price_field in cart.extra_price_fields %}
            <tr>
                <td colspan="2">&nbsp;</td>
                <td>{{ extra_price_field.0 }}</td>
                <td>{{ extra_price_field.1 }}</td>
             </tr>
            {% endfor %}
            <tr><td colspan="2">&nbsp;</td><td><b>{% trans "Cart Total" %}</b></td><td><b>{{cart.total_price}}</b></td></tr>
        </tfoot>
    </table>
</form>

<form action="{% url 'cart_delete' %}" method="post">
    {% csrf_token %}
    {% if not request.GET.err and cart.total_price <= user.coins.count %}
    <a href="{% url 'checkout_selection' %}" class="button">{% trans "Proceed to checkout" %}</a>
    {% endif %}
    <div class="clear"></div>
    <input type="submit" class="empty" value="{% trans "Empty Shopping Cart" %}"/>
</form>


{% else %}
<p>
{% trans "Shopping cart is empty" %}
</p>
{% endif %}
{% endblock %}